---
title: "Appendix for 'Framing Effects in the Wild'"
author: "Nicolai Berk"
date: "15 5 2022"
output: 
  pdf_document:
    number_sections: TRUE
toc: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F, warning = F, cache = T, fig.height=6, fig.width=10, fig.align='center')

library(tidyverse)
library(dplyr)
library(data.table)
library(here)
library(patchwork)

# load self-made functions
for (filename in list.files(here("code/functions"))){
  source(here(paste0('code/functions/', filename)))
}
```

# Frames in Communication

## Market Coverage of Different Newspapers

Table 1 shows the number of print copies sold and online page impressions for each newspaper per day. It becomes clear that German newspapers have a rather important position in the German news market. The tabloid \textit{Bild} has by far the largest reach, with over 1.7 Million sold newspaper daily and around 550 million web visits per month. For reference: the German Wikipedia site had less than twice as many visits (975 million) in the same time frame \footnote{Wikipedia Siteviews Analyisis: https://pageviews.wmcloud.org/siteviews/}. Bild is closely followed by the weekly published \textit{Spiegel}. The daily broadsheets sell less, and interestingly the online presence seems to be dominated by the right, given the weak presence of centre-left \textit{SZ} and left-wing \textit{taz}.

```{=tex}
\begin{table}[!htbp] \centering
    \begin{tabular}{@{\extracolsep{5pt}} lcc}
    \\[-1.8ex]\hline
    \hline \\[-1.8ex]
    Paper & Print Sales & Web Impressions \\
     & (thousands) & (millions) \\
    \hline \\[-1.8ex]
    Bild & 1756 & 555 \\
    Spiegel & 758 & 388 \\
    FAZ & 242 & 123 \\
    SZ & 358 & 13 \\
    taz & 51 & 7 \\
    Welt & 521 & 135 \\
    \hline \\[-1.8ex]
    \end{tabular}
  \caption{Average daily sales and monthly online impressions of different newspapers in 2017. Source: Informationsgemeinschaft zur Feststellung der Verbreitung von Werbeträgern e. V. (2021). Quartalsauflagen. https://ivw.de/aw/print/qa. Table generated with stargazer.}
  \label{tab:paper_sales}
\end{table}
```

## BERT Classifiers

### Migration

### Crime

## Salience of Migration


## Correcting for change in DPA-sourced content

Among the changes after Reichelt's takeover as chief editor of *Bild* was a severe drop in the overall number of articles published online. Figure \@ref(fig:dpaShare) shows the monthly number of articles *Bild* published in their online archive across time. Recall that Reichelt took over in February 2017, and briefly after - in June 2017 - the overall number of articles published decreases by over 60%. The graph also suggests an explanation for this sudden shift: the share of articles sourced from DPA, a major German press agency alike the Associated Press, sharply decreases at the same time as the major decrease in the number of articles takes place (see top blue bars). DPA is a press agency supplying many German news outlets, which means it must have a rather unbiased or at least centrist coverage, potentially decreasing the estimate of crime frames within Bild's migration content. This would not be a problem, as long as this content is equally likely to make it to the front page. However, *Bild* likely gives more weight to its own content compared to pre-written content from DPA. For this reason, the paper presented data excluding DPA content. On the other hand, the decision to discontinue buying content from DPA must have been made by Reichelt himself and is thus an outcome of the treatment. Hence, it is fruitful to assess the change including DPA-sourced content. 

```{r dpaShare, fig.cap="Monthly number of articles by source."}

data.table::fread(here("data/raw/newspapers/_bild_articles.csv"), 
                  encoding = "UTF-8") %>% 
  mutate(
    dpa = str_detect(text, "(dpa)")
  ) %>% 
  mutate(month = lubridate::floor_date(date, "month")) %>% 
  mutate(
    dpa = ifelse(dpa, "DPA", "Original")
  ) %>%
  ggplot(aes(x = month, fill = dpa)) +
  geom_bar() +
  theme_minimal() +
  ggtitle("Monthly number of articles, Bild online", "By origin, 2013-2019") + 
  xlab("") + ylab("N") +
  scale_fill_manual(name = "Source",
                    values = MetBrewer::met.brewer("Archambault", 2))


```

The left panel of figure \@ref(fig:treatmentDPAcorr) displays the quarterly share of migration articles discussing crime for *Bild* compared to all other newspapers. A depression is visible in 2016-2017 which was not visible in the corrected data. The share of crime content in *Bild*'s migration coverage strongly increases a few months following the treatment, when the share of DPA-sourced content severely drop. The gap between *Bild* and all other newspapers increases, and this increased difference persists. This change becomes even more visible in the right-hand panel, which shows a difference-in-differences estimate of the change of the share of crime news in a newspapers migration content, this time controlling for whether the content is DPA-sourced or not. The general picture is quite similar to the original estimate in the paper, as migration coverage only increases in *Bild*, while all other outlets remain rather stable on this metric. In the estimate including DPA content, the share of migration coverage devoted to crime increases by an even stronger 6 percentage points, which still constitutes a very substantial increase. Both ways of handling the data suggest a strong increase in the emphasis of crime in migration coverage.

```{r treatmentDPAcorr, fig.cap="Change in share of crime content in newspaper coverage, excluding DPA-sourced news content. Left panel: quarterly share across time, Bild compared to other newspapers' average. Right panel: difference-in-differences estimates of change in newspaper coverage compared to other newspapers, controlling for source of content."}

TreatmentTrendPlot(dpa_corrected = F) + 
  TreatmentDiDPlot(dpa_corrected = F)

```

# Readership models

## Inward selection

```{r inselection, fig.cap="Coefficients of OLS regression of readership on migration attitude across waves. Vertical lines indicate 95% confidence intervals, dashed (red) vertical line indicates editorial change."}

InSelection()

```


# Difference-in-Differences Estimates

Treated Group: Bild Readers in first (and only pre-treatment) wave. Control Group: Never-Readers of Bild. Post Date: $>=$ 01.02.2017

## Descriptives

Show Demographics for Treatment and Control Groups.

```{r, bild_descriptives}

gles_p_long <- fread(here('data/raw/gles/Panel/long_cleaned.csv'))

desc <- 
  gles_p_long %>% 
  filter(wave == "1", !is.na(treat)) %>% 
  group_by(treat) %>% 
  select(gender_clean, ybirth_clean, `010_clean`, 
         `1130_clean`, `1500_clean`, `afd_vote`, `430i_clean`) %>%
  mutate(gender_clean = gender_clean-1) %>% 
  mutate(across(.fns = as.integer)) %>% 
  summarise(across(.fns = mean, na.rm = T)) %>% 
  select(-treat) %>% 
  t() %>% round(2)

colnames(desc) <- c("Control", "Treatment")
row.names(desc) <- c("Gender (0 = m, 1 = f)", "Birthyear", 
                     "Political interest (1, 5)", "Immigration Attitude (-3, 3)",
                     "General left-right (0-10)", "Share of AfD supporters", "AfD attitude (-5, 5)")

knitr::kable(desc, align = c("c", "c"))

rm(gles_p_long, desc)

```

Note that the variable "Birthyear" is left-censored in the data. All respondents born before 1955 were assigned 1955 as birth year.

## DiD assumptions

### Parallel Trends

Figure \@ref(fig:parallelTrends) shows the development of migration attitudes among a panel of Bild readers\footnote{Readership was measured in a single wave in late 2015.} and non-readers across time, recorded in the German Longitudinal Election Study's Longterm Panel [@SOURCE]. This is a far smaller sample with a limited time frame and hence less useful for the precise estimation of the effects of changing migration framing. The plot shows that both groups move along a similar long-term trend, slowly becoming more conservative, while moving into similar directions along the way. The only difference between the two groups is that Bild readers seem to be more conservative in late 2015 (note that only the last three interviews were conducted in January 2016). However this deviation lies well within the 95% confidence interval and those not reading Bild move in a similar direction, albeit less strongly. The parallel trends assumption seems to be generally met.

```{r parallelTrends, fig.cap = "Migration Attitude among Bild-readers compared to non-readers across Time"}

ParallelTrendsPlot()

```

## Effect in Longterm-Panel

### Reichelt

```{r LTPDiD, fig.height=2}

LTPDiD()

```

```{r LTPDiD_table}

LTPDiD(return_table = T)

```



## Variable: Immigration Attitudes

### Outcome: Reduce Immigration (1130)

#### Question Text

Jetzt geht es um Zuzugsmöglichkeiten für Ausländer. Sollten die Zuzugsmöglichkeiten für Ausländer erleichtert oder eingeschränkt werden?

(1) Zuzug von Ausländern erleichtern
(2)
(3)
(4)
(5)
(6)
(7) Zuzug von Ausländern einschränken

*Recoded to [-3, 3].*

#### Treatment groups across time

(add counterfactual if time)

```{r did_imm_att_plot}

fread(here('data/raw/gles/Panel/long_cleaned.csv')) %>% 
  filter(!is.na(`1130_clean`), !is.na(treat)) %>% 
  group_by(treat, wave) %>% 
  summarise(
    date_clean = min(date_clean, na.rm = T),
    mig_mean = mean(`1130_clean`, na.rm = T),
    mig_sd = sd(`1130_clean`, na.rm = T),
    N = n()
  ) %>% 
  mutate(
    mig_lower = mig_mean + qt(0.025, df = N-1) * (mig_sd/sqrt(N)),
    mig_upper = mig_mean + qt(0.975, df = N-1) * (mig_sd/sqrt(N))
  ) %>% 
  ggplot(aes(x = date_clean, y = mig_mean,
             ymin = mig_lower, ymax = mig_upper,
             lty = !treat, col = !treat)) +
  geom_line() +
  geom_pointrange() +
  geom_vline(xintercept = as.Date("2017-02-01"), lty = 2, col = "red") + 
  theme_minimal() +
  labs( x = "", y = "", col = "Readership", lty = "Readership") +
  scale_color_manual(labels = c("Bild", "Never Bild"),
                     values = MetBrewer::met.brewer("Archambault", 2)) +
  scale_linetype_manual(labels = c("Bild", "Never Bild"),
                     values = c(1,2))

```

#### Effect of Reichelt takeover

```{r did_imm_att}

SingleDVModel('1130_clean')

```

### Outcome: Integration Attitude (1210)

#### Question Text

Es gibt unterschiedliche Auffassungen darüber, wie sehr sich Ausländer in Deutschland anpassen sollten. Manche denken, dass sich Ausländer vollständig an die deutsche Kultur anpassen sollten. Andere denken, Ausländer sollten auch hier möglichst nach der eigenen Kultur leben können.

(1) Ausländer sollten sich vollständig an die deutsche Kultur anpassen
(2) 
(3) 
(4) 
(5) 
(6) 
(7) Ausländer sollten möglichst nach eigener Kultur leben können

*Recoded to [-3, 3].*

#### Effect of Reichelt takover

```{r did_int_att}

SingleDVModel("1210_clean")

```

## Variable: Voting Behaviour

### Outcome: Scalometer AfD (430i)

#### QUESTION TEXT MISSING

#### DiD Estimate


```{r afd_scale}

SingleDVModel("430i_clean")

```


## Variable: Issue Importance

### Outcome: MIP Migration (840s)

#### QUESTION TEXT MISSING

#### DiD Estimate

```{r did_mip_mig}

SingleDVModel("mip_mig")

```


## Variable: Crime Considerations

### Attitudes towards fighting crime (2880h)

#### Question Text

Die staatlichen Befugnisse in der Kriminalitätsbekämpfung sollten ausgeweitet werden, auch wenn das zu einer stärkeren Überwachung der Bürger führt.

(1) stimme überhaupt nicht zu
(2) stimme eher nicht zu
(3) teils/teils
(4) stimme eher zu
(5) stimme voll und ganz zu

#### Direct Effect

```{r did_crime_att}

SingleDVModel("2880h_clean")

```

#### Bootstrap of correlations

```{r crime_mig_cor}

cors <- 
  fread(here('data/raw/gles/Panel/long_cleaned.csv')) %>% 
  filter(!is.na(`1130_clean`), !is.na(`2880h_clean`), !is.na(treat)) %>% 
  group_by(treat, post) %>% 
  summarise(mig_crime_cor = cor(`1130_clean`, `2880h_clean`, use = "complete.obs")) %>% 
  mutate(universe = "factual")

cors <- 
  cors %>% 
  rbind(
    data.frame(
      treat = c(TRUE, TRUE),
      post = c(FALSE, TRUE),
      mig_crime_cor = c(cors[cors$treat & !cors$post, "mig_crime_cor"][[1]], 
                        cors[cors$treat & !cors$post, "mig_crime_cor"][[1]] +  
                          sqrt((cors[cors$treat & cors$post, "mig_crime_cor"][[1]] -
                          cors[!cors$treat & cors$post, "mig_crime_cor"][[1]])^2)),
      universe = "counterfactual"
    ), 
  ) %>% 
  mutate(universe = factor(universe, levels = c("factual", "counterfactual")))


cors %>% 
  mutate(treat_universe = paste(treat, universe, sep = "_")) %>% 
  ggplot(aes(x = post, y = mig_crime_cor, col = treat, lty = universe, group = treat_universe)) +
  geom_point() +
  geom_line() +
  theme_minimal()

```


#### Interaction of DiD with Crime Attitude (following Nelson & Kinder 1996)

(Association of Crime with migration attitude should be sigificantly higher in post-treatment-group)

```{r did_cond_crime}

gles_p_long <- fread(here('data/raw/gles/Panel/long_cleaned.csv'))

# define dv and conditioning variable
gles_p_long[["dv"]] <- gles_p_long[["1130_clean"]]
gles_p_long[["crime_att"]] <- gles_p_long[["2880h_clean"]]
gles_p_long$Individual <- gles_p_long$lfdn

inter <- 
  feglm(dv ~ post * treat * crime_att, 
        cluster = c("Individual"), 
        data = gles_p_long %>% 
          filter(!is.na(dv), !is.na(treat), !is.na(post), !is.na(crime_att)))

inter_cond <- 
  feglm(dv ~ post * treat * init_mig * crime_att , 
        cluster = c("Individual"), 
        data = gles_p_long %>% 
          filter(!is.na(dv), !is.na(treat), !is.na(post), 
                 !is.na(crime_att), !is.na(init_mig)))

inter_fe_cond <- 
  feglm(dv ~ post * treat * init_mig * crime_att | Individual, 
        cluster = c("Individual"), 
        data = gles_p_long %>% 
          filter(!is.na(dv), !is.na(treat), !is.na(post), 
                 !is.na(crime_att), !is.na(init_mig)))

inter_fe <- 
  feglm(dv ~ post * treat * crime_att | Individual, 
        cluster = c("Individual"), 
        data = gles_p_long %>% 
          filter(!is.na(dv), !is.na(treat), !is.na(post), !is.na(crime_att)))

modelsummary(
  list(
    inter, inter_fe, inter_cond, inter_fe_cond
  ),
  stars = T,
  # coef_map =
  #   c("postTRUE:treatTRUE" = "ATE",
  #     "postTRUE:treatTRUE:crime_att" = "ATE X Crime Attitude",
  #     "postTRUE:treatTRUE:init_mig:crime_att" = "ATE X Crime Attitude X \nInitial Migration Attitude"),
  gof_omit = "^(?!R2.Pseudo|Num|Std|FE)", 
  output = "markdown"
)

rm(gles_p_long, inter, inter_fe, inter_cond, inter_fe_cond)


```

